(()=>{"use strict";var e,t={},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}function o(e,t,n){var r,o,a;if(0==t)r=o=a=n;else{function s(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var i=n<.5?n*(1+t):n+t-n*t,l=2*n-i;r=s(l,i,e+1/3),o=s(l,i,e),a=s(l,i,e-1/3)}return[255*r,255*o,255*a]}function a(e,t,n){e/=255,t/=255,n/=255;var r,o,a=Math.max(e,t,n),i=Math.min(e,t,n),l=(a+i)/2;if(a==i)r=o=0;else{var s=a-i;switch(o=l>.5?s/(2-a-i):s/(a+i),a){case e:r=(t-n)/s+(t<n?6:0);break;case t:r=(n-e)/s+2;break;case n:r=(e-t)/s+4}r/=6}return[r,o,l]}r.m=t,r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,n)=>(r.f[n](e,t),t)),[])),r.u=e=>e+".index.js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},r.l=(t,n,o,a)=>{if(e[t])e[t].push(n);else{var i,l;if(void 0!==o)for(var s=document.getElementsByTagName("script"),c=0;c<s.length;c++){var f=s[c];if(f.getAttribute("src")==t){i=f;break}}i||(l=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,r.nc&&i.setAttribute("nonce",r.nc),i.src=t),e[t]=[n];var d=(n,r)=>{i.onerror=i.onload=null,clearTimeout(h);var o=e[t];if(delete e[t],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(r))),n)return n(r)},h=setTimeout(d.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=d.bind(null,i.onerror),i.onload=d.bind(null,i.onload),l&&document.head.appendChild(i)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{r.b=document.baseURI||self.location.href;var e={792:0};r.f.j=(t,n)=>{var o=r.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var a=new Promise(((n,r)=>o=e[t]=[n,r]));n.push(o[2]=a);var i=r.p+r.u(t),l=new Error;r.l(i,(n=>{if(r.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var a=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;l.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",l.name="ChunkLoadError",l.type=a,l.request=i,o[1](l)}}),"chunk-"+t,t)}};var t=(t,n)=>{var o,a,[i,l,s]=n,c=0;if(i.some((t=>0!==e[t]))){for(o in l)r.o(l,o)&&(r.m[o]=l[o]);s&&s(r)}for(t&&t(n);c<i.length;c++)a=i[c],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),async function(){const e=navigator.hardwareConcurrency,t=[];for(let n=0;n<e;n++){const e=new Worker("./jsWorker.js");t.push(e)}let n,i,l,s,c=await(async e=>{try{return"undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(e)}catch(e){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]));if(console.log("SUPPORT_THREADS",c),c){s=await r.e(780).then(r.bind(r,780));let{memory:e}=await s.default();await s.initThreadPool(navigator.hardwareConcurrency),n=s.new_buffer,i=s.harmonize_rayon,l=e}else{s=await r.e(308).then(r.bind(r,308));let{memory:e}=await s.default();n=s.new_buffer,i=s.harmonize_rayon,l=e}document.getElementById("wasm-title").innerText="wasm multi-thread";const f=new Image,d=new Image,h=new Image,u=new Image,m=document.getElementById("wasm-t"),g=document.getElementById("js-t"),w=document.getElementById("js-m-t"),p=document.getElementById("gl-t");let v=null,b=null;function T(e,t,r,o){const s=document.getElementById("c1"),c=e.width,f=e.height;s.width=c,s.height=f;const d=s.getContext("2d");d.drawImage(e,0,0,c,f);let h=performance.now();if(!v){v=n("test",c*f*4);const e=d.getImageData(0,0,c,f);b=new Uint8ClampedArray(l.buffer,v,c*f*4),b.set(e.data)}let[u,g]=a(t,r,o);i("test",u,g),d.putImageData(new ImageData(b.slice(),c,f),0,0);let w=performance.now();console.log("wasm",Math.floor(w-h)+"ms"),m.innerHTML=Math.floor(w-h)+"ms"}function _(e,t,n,r){const i=document.getElementById("c2"),l=e.width,s=e.height;i.width=l,i.height=s;const c=i.getContext("2d");c.drawImage(e,0,0,l,s);const f=c.getImageData(0,0,l,s);let d=performance.now();const h=f.data;let[u,m]=a(t,n,r);for(let e=0;e<h.length;e+=4){const[t,n,r]=[h[e],h[e+1],h[e+2]],i=a(t,n,r);i[0]=u,m>.1&&(i[1]=m);const l=o(i[0],i[1],i[2]);h[e]=l[0],h[e+1]=l[1],h[e+2]=l[2]}c.putImageData(f,0,0);let w=performance.now();console.log("JS",Math.floor(w-d)+"ms"),g.innerHTML=Math.floor(w-d)+"ms"}f.onload=()=>{T(f,202,208,195)},d.onload=()=>{_(d,202,208,195)},h.onload=()=>{y(h,202,208,195)},u.onload=()=>{A(u,202,208,195)};const E=document.getElementById("origin").src;console.log(E),f.src=E,d.src=E,h.src=E,u.src=E;const x=document.getElementById("color-input");function y(n,r,o,a){const i=document.getElementById("c3"),l=n.width,s=n.height;i.width=l,i.height=s;const c=i.getContext("2d");c.drawImage(n,0,0,l,s);const f=c.getImageData(0,0,l,s).data;let d=performance.now();const h=Math.ceil(i.height/e);for(let e=0;e<t.length;e++){const n=e*h*i.width*4,l=Math.min(h*i.width*4,f.length-n),s=f.slice(n,n+l);t[e].postMessage({imageData:s,width:i.width,height:h,r,g:o,b:a,offset:n},[s.buffer])}let u=0;for(let e=0;e<t.length;e++)t[e].onmessage=function(e){const{imageData:n,offset:r}=e.data;if(f.set(new Uint8ClampedArray(n),r),u++,u===t.length){c.putImageData(new ImageData(f,l,s),0,0);let e=performance.now();console.log("JS multi worker",Math.floor(e-d)+"ms"),w.innerHTML=Math.floor(e-d)+"ms"}}}function A(e,t,n,r){let[o,i]=a(t,n,r);const l=performance.now();!function(e){if(window._glDraw)return void window._glDraw(o,i);var t=new OffscreenCanvas(e.width,e.height);const n=document.querySelector("#c4");var r=t.getContext("webgl2");if(r){var a=webglUtils.createProgramFromSources(r,["#version 300 es\n  \n  // an attribute is an input (in) to a vertex shader.\n  // It will receive data from a buffer\n  in vec2 a_position;\n  in vec2 a_texCoord;\n  \n  // Used to pass in the resolution of the canvas\n  uniform vec2 u_resolution;\n  \n  // Used to pass the texture coordinates to the fragment shader\n  out vec2 v_texCoord;\n  \n  // all shaders have a main function\n  void main() {\n  \n    // convert the position from pixels to 0.0 to 1.0\n    vec2 zeroToOne = a_position / u_resolution;\n  \n    // convert from 0->1 to 0->2\n    vec2 zeroToTwo = zeroToOne * 2.0;\n  \n    // convert from 0->2 to -1->+1 (clipspace)\n    vec2 clipSpace = zeroToTwo - 1.0;\n  \n    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n  \n    // pass the texCoord to the fragment shader\n    // The GPU will interpolate this value between points.\n    v_texCoord = a_texCoord;\n  }\n  ",'#version 300 es\n  \n  // fragment shaders don\'t have a default precision so we need\n  // to pick one. highp is a good default. It means "high precision"\n  precision highp float;\n  \n  // our texture\n  uniform sampler2D u_image;\n  uniform vec2 test_color;\n  // the texCoords passed in from the vertex shader.\n  in vec2 v_texCoord;\n  \n  // we need to declare an output for the fragment shader\n  out vec4 outColor;\n  float hue2rgb(float p, float q, float t) {\n    if (t < 0.0) t += 1.0;\n    if (t > 1.0) t -= 1.0;\n    if (t < 1.0 / 6.0) return p + (q - p) * 6.0 * t;\n    if (t < 1.0 / 2.0) return q;\n    if (t < 2.0 / 3.0) return p + (q - p) * (2.0 / 3.0 - t) * 6.0;\n    return p;\n  }\n  vec3 hslToRgb(vec3 hsl) {\n    float h = hsl.x;\n    float s = hsl.y;\n    float l = hsl.z;\n    float r, g, b;\n  \n    if (s == 0.0) {\n      r = g = b = l; // achromatic\n    } else {\n      float q = l < 0.5 ? l * (1.0 + s) : l + s - l * s;\n      float p = 2.0 * l - q;\n      \n      \n  \n      r = hue2rgb(p, q, h + 1.0 / 3.0);\n      g = hue2rgb(p, q, h);\n      b = hue2rgb(p, q, h - 1.0 / 3.0);\n    }\n  \n    return vec3(r, g, b);\n  }\n  vec3 rgbToHsl(vec3 color) {\n    float r = color.r;\n    float g = color.g;\n    float b = color.b;\n    float max = max(r, max(g, b));\n    float min = min(r, min(g, b));\n    float h, s, l = (max + min) * 0.5;\n  \n    if (max == min) {\n      h = s = 0.0; // achromatic\n    } else {\n      float d = max - min;\n      s = l > 0.5 ? d / (2.0 - max - min) : d / (max + min);\n  \n      if (max == r) {\n        h = (g - b) / d + (g < b ? 6.0 : 0.0);\n      } else if (max == g) {\n        h = (b - r) / d + 2.0;\n      } else if (max == b) {\n        h = (r - g) / d + 4.0;\n      }\n  \n      h /= 6.0;\n    }\n  \n    return vec3(h, s, l);\n  }\n  void main() {\n    float ch=test_color[0];\n    float cs=test_color[1];\n    \n    vec3 rawColor = texture(u_image, v_texCoord).rgb;\n    vec3 hsl=rgbToHsl(rawColor);\n    hsl[0]=ch;\n    if(cs>0.1){\n      hsl[1]=cs;\n    }\n    outColor=vec4(hslToRgb(hsl),1.0);\n  }\n  ']),l=r.getAttribLocation(a,"a_position"),s=r.getAttribLocation(a,"a_texCoord"),c=r.getUniformLocation(a,"test_color"),f=r.getUniformLocation(a,"u_resolution"),d=r.getUniformLocation(a,"u_image"),h=r.createVertexArray();r.bindVertexArray(h);var u=r.createBuffer();r.enableVertexAttribArray(l),r.bindBuffer(r.ARRAY_BUFFER,u);var m=2,g=r.FLOAT,w=!1,p=0,v=0;r.vertexAttribPointer(l,m,g,w,p,v);var b=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,b),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),r.STATIC_DRAW),r.enableVertexAttribArray(s),m=2,g=r.FLOAT,w=!1,p=0,v=0,r.vertexAttribPointer(s,m,g,w,p,v);var T=r.createTexture();r.activeTexture(r.TEXTURE0+0),r.bindTexture(r.TEXTURE_2D,T),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST);var _=r.RGBA,E=r.RGBA,x=r.UNSIGNED_BYTE;r.texImage2D(r.TEXTURE_2D,0,_,E,x,e),r.viewport(0,0,r.canvas.width,r.canvas.height),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.useProgram(a),r.bindVertexArray(h),r.uniform2f(f,r.canvas.width,r.canvas.height),r.uniform2f(c,o,i),r.uniform1i(d,0),r.bindBuffer(r.ARRAY_BUFFER,u),function(e,t,n,r,o){var a=0+r,i=0+o;e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,a,0,0,i,0,i,a,0,a,i]),e.STATIC_DRAW)}(r,0,0,e.width,e.height);var y=r.TRIANGLES;v=0,r.drawArrays(y,v,6),n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(t,0,0,t.width,t.height),window._glDraw=(e,o)=>{r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.uniform2f(c,e,o),r.drawArrays(y,v,6),n.getContext("2d").drawImage(t,0,0,t.width,t.height)}}}(e);const s=performance.now();p.innerText=(s-l).toFixed(3)+"ms",console.log("webgl",(s-l).toFixed(3)+"ms")}[...document.querySelectorAll("input")].filter((e=>"checkbox"===e.type)).map((e=>{const t=e.className;window[t]=!0,e.oninput=e=>{window[t]=e.target.checked}})),x.oninput=e=>{const t=function(e){let t=e.replace("#","");if(t.length%3)return"hex格式不正确！";let n=t.length/3,r=6/t.length;return[parseInt("0x"+t.substring(0*n,1*n))**r,parseInt("0x"+t.substring(1*n,2*n))**r,parseInt("0x"+t.substring(2*n))**r]}(e.target.value);window._wasm&&T(f,...t),window._jss&&_(d,...t),window._jsm&&y(h,...t),window._webgl&&A(u,...t)}}()})();