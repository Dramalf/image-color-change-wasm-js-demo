(()=>{"use strict";var e,t={},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.m=t,r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,n)=>(r.f[n](e,t),t)),[])),r.u=e=>e+".index.js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},r.l=(t,n,o,a)=>{if(e[t])e[t].push(n);else{var i,s;if(void 0!==o)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var h=l[c];if(h.getAttribute("src")==t){i=h;break}}i||(s=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,r.nc&&i.setAttribute("nonce",r.nc),i.src=t),e[t]=[n];var u=(n,r)=>{i.onerror=i.onload=null,clearTimeout(f);var o=e[t];if(delete e[t],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(r))),n)return n(r)},f=setTimeout(u.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=u.bind(null,i.onerror),i.onload=u.bind(null,i.onload),s&&document.head.appendChild(i)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{r.b=document.baseURI||self.location.href;var e={792:0};r.f.j=(t,n)=>{var o=r.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var a=new Promise(((n,r)=>o=e[t]=[n,r]));n.push(o[2]=a);var i=r.p+r.u(t),s=new Error;r.l(i,(n=>{if(r.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var a=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",s.name="ChunkLoadError",s.type=a,s.request=i,o[1](s)}}),"chunk-"+t,t)}};var t=(t,n)=>{var o,a,[i,s,l]=n,c=0;if(i.some((t=>0!==e[t]))){for(o in s)r.o(s,o)&&(r.m[o]=s[o]);l&&l(r)}for(t&&t(n);c<i.length;c++)a=i[c],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();let o,a,i,s,l=new Image,c=document.getElementById("wasm-t"),h=null,u=null;function f(e,t){const n=document.getElementById("c1"),r=l.width,o=l.height;n.width=r,n.height=o;const i=n.getContext("2d");i.drawImage(l,0,0,r,o);let s=performance.now();const h=i.getImageData(0,0,r,o);u.set(h.data),a("wasm",e,t),i.putImageData(new ImageData(u.slice(),r,o),0,0);let f=performance.now();console.log("wasm",Math.floor(f-s)+"ms"),c.innerHTML=Math.floor(f-s)+"ms"}function m(e,t,n){var r,o,a;if(0==t)r=o=a=n;else{function l(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var i=n<.5?n*(1+t):n+t-n*t,s=2*n-i;r=l(s,i,e+1/3),o=l(s,i,e),a=l(s,i,e-1/3)}return[255*r,255*o,255*a]}function d(e,t,n){e/=255,t/=255,n/=255;var r,o,a=Math.max(e,t,n),i=Math.min(e,t,n),s=(a+i)/2;if(a==i)r=o=0;else{var l=a-i;switch(o=s>.5?l/(2-a-i):l/(a+i),a){case e:r=(t-n)/l+(t<n?6:0);break;case t:r=(n-e)/l+2;break;case n:r=(e-t)/l+4}r/=6}return[r,o,s]}const g=new Image,w=document.getElementById("c2");let p=document.getElementById("js-t");function v(e,t){const n=w.width,r=w.height,o=w.getContext("2d");o.drawImage(g,0,0,n,r);const a=o.getImageData(0,0,n,r);let i=performance.now();const s=a.data;for(let n=0;n<s.length;n+=4){const[r,o,a]=[s[n],s[n+1],s[n+2]],i=d(r,o,a);i[0]=e,t>.1&&(i[1]=t);const l=m(i[0],i[1],i[2]);s[n]=l[0],s[n+1]=l[1],s[n+2]=l[2]}o.putImageData(a,0,0);let l=performance.now();console.log("JS",Math.floor(l-i)+"ms"),p.innerHTML=Math.floor(l-i)+"ms"}const b=navigator.hardwareConcurrency,T=[];let x=document.getElementById("js-m-t");for(let e=0;e<b;e++){const e=new Worker("./jsWorker.js");T.push(e)}const E=document.getElementById("c3"),_=new Image;function y(e,t){const n=E.getContext("2d"),r=E.width,o=E.height;n.drawImage(_,0,0,r,o);const a=n.getImageData(0,0,r,o).data;let i=performance.now();const s=Math.ceil(E.height/b);for(let n=0;n<T.length;n++){const r=n*s*E.width*4,o=Math.min(s*E.width*4,a.length-r),i=a.slice(r,r+o);T[n].postMessage({imageData:i,ch:e,cs:t,offset:r},[i.buffer])}let l=0;for(let e=0;e<T.length;e++)T[e].onmessage=function(e){const{imageData:t,offset:s}=e.data;if(a.set(new Uint8ClampedArray(t),s),l++,l===T.length){n.putImageData(new ImageData(a,r,o),0,0);let e=performance.now();console.log("JS multi worker",Math.floor(e-i)+"ms"),x.innerHTML=Math.floor(e-i)+"ms"}}}const A=document.querySelector("#c4");let R=null,I=null,C=null,B=document.getElementById("gl-t");function U(e,t){const n=performance.now();var r=I.TRIANGLES;I.clearColor(0,0,0,0),I.clear(I.COLOR_BUFFER_BIT|I.DEPTH_BUFFER_BIT),I.uniform2f(C,e,t),I.drawArrays(r,0,6),A.getContext("2d").drawImage(R,0,0,A.width,A.height);const o=performance.now();B.innerText=parseFloat((o-n).toFixed(3))+"ms",console.log("webgl",(o-n).toFixed(3)+"ms")}function D(e,t,n){e/=255,t/=255,n/=255;var r,o,a=Math.max(e,t,n),i=Math.min(e,t,n),s=(a+i)/2;if(a==i)r=o=0;else{var l=a-i;switch(o=s>.5?l/(2-a-i):l/(a+i),a){case e:r=(t-n)/l+(t<n?6:0);break;case t:r=(n-e)/l+2;break;case n:r=(e-t)/l+4}r/=6}return[r,o,s]}!async function(){const[e,t]=D(202,208,195),n=document.getElementById("origin").src;(async function(e,t,n){let c=await(async e=>{try{return"undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(e)}catch(e){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]));if(c){s=await r.e(780).then(r.bind(r,780));let{memory:e}=await s.default();console.log(navigator.hardwareConcurrency,"navigator.hardwareConcurrency"),await s.initThreadPool(navigator.hardwareConcurrency),o=s.new_buffer,a=s.harmonize_rayon,i=e}else{s=await r.e(308).then(r.bind(r,308));let{memory:e}=await s.default();o=s.new_buffer,a=s.harmonize_rayon,i=e}document.getElementById("wasm-title").innerText=c?"wasm multi-thread":"wasm single-thread",l.onload=()=>{const{width:e,height:r}=l;h=o("wasm",e*r*4),u=new Uint8ClampedArray(i.buffer,h,e*r*4),f(t,n)},l.src=e})(n,e,t),function(e,t,n){g.onload=()=>{const e=g.width,r=g.height;w.width=e,w.height=r,v(t,n)},g.src=e}(n,e,t),function(e,t,n){_.onload=()=>{const e=_.width,r=_.height;E.width=e,E.height=r,y(t,n)},_.src=e}(n,e,t),async function(e,t,n){const r=new Image;if(await new Promise((t=>{r.onload=t,r.src=e})),R=new OffscreenCanvas(r.width,r.height),A.width=r.width,A.height=r.height,I=R.getContext("webgl2"),I){var o=webglUtils.createProgramFromSources(I,["#version 300 es\n  \n    // an attribute is an input (in) to a vertex shader.\n    // It will receive data from a buffer\n    in vec2 a_position;\n    in vec2 a_texCoord;\n    \n    // Used to pass in the resolution of the canvas\n    uniform vec2 u_resolution;\n    \n    // Used to pass the texture coordinates to the fragment shader\n    out vec2 v_texCoord;\n    \n    // all shaders have a main function\n    void main() {\n    \n      // convert the position from pixels to 0.0 to 1.0\n      vec2 zeroToOne = a_position / u_resolution;\n    \n      // convert from 0->1 to 0->2\n      vec2 zeroToTwo = zeroToOne * 2.0;\n    \n      // convert from 0->2 to -1->+1 (clipspace)\n      vec2 clipSpace = zeroToTwo - 1.0;\n    \n      gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n    \n      // pass the texCoord to the fragment shader\n      // The GPU will interpolate this value between points.\n      v_texCoord = a_texCoord;\n    }\n    ",'#version 300 es\n    \n    // fragment shaders don\'t have a default precision so we need\n    // to pick one. highp is a good default. It means "high precision"\n    precision highp float;\n    \n    // our texture\n    uniform sampler2D u_image;\n    uniform vec2 test_color;\n    // the texCoords passed in from the vertex shader.\n    in vec2 v_texCoord;\n    \n    // we need to declare an output for the fragment shader\n    out vec4 outColor;\n    float hue2rgb(float p, float q, float t) {\n      if (t < 0.0) t += 1.0;\n      if (t > 1.0) t -= 1.0;\n      if (t < 1.0 / 6.0) return p + (q - p) * 6.0 * t;\n      if (t < 1.0 / 2.0) return q;\n      if (t < 2.0 / 3.0) return p + (q - p) * (2.0 / 3.0 - t) * 6.0;\n      return p;\n    }\n    vec3 hslToRgb(vec3 hsl) {\n      float h = hsl.x;\n      float s = hsl.y;\n      float l = hsl.z;\n      float r, g, b;\n    \n      if (s == 0.0) {\n        r = g = b = l; // achromatic\n      } else {\n        float q = l < 0.5 ? l * (1.0 + s) : l + s - l * s;\n        float p = 2.0 * l - q;\n        \n        \n    \n        r = hue2rgb(p, q, h + 1.0 / 3.0);\n        g = hue2rgb(p, q, h);\n        b = hue2rgb(p, q, h - 1.0 / 3.0);\n      }\n    \n      return vec3(r, g, b);\n    }\n    vec3 rgbToHsl(vec3 color) {\n      float r = color.r;\n      float g = color.g;\n      float b = color.b;\n      float max = max(r, max(g, b));\n      float min = min(r, min(g, b));\n      float h, s, l = (max + min) * 0.5;\n    \n      if (max == min) {\n        h = s = 0.0; // achromatic\n      } else {\n        float d = max - min;\n        s = l > 0.5 ? d / (2.0 - max - min) : d / (max + min);\n    \n        if (max == r) {\n          h = (g - b) / d + (g < b ? 6.0 : 0.0);\n        } else if (max == g) {\n          h = (b - r) / d + 2.0;\n        } else if (max == b) {\n          h = (r - g) / d + 4.0;\n        }\n    \n        h /= 6.0;\n      }\n    \n      return vec3(h, s, l);\n    }\n    void main() {\n      float ch=test_color[0];\n      float cs=test_color[1];\n      \n      vec3 rawColor = texture(u_image, v_texCoord).rgb;\n      vec3 hsl=rgbToHsl(rawColor);\n      hsl[0]=ch;\n      if(cs>0.1){\n        hsl[1]=cs;\n      }\n      outColor=vec4(hslToRgb(hsl),1.0);\n    }\n    ']),a=I.getAttribLocation(o,"a_position"),i=I.getAttribLocation(o,"a_texCoord");C=I.getUniformLocation(o,"test_color");var s=I.getUniformLocation(o,"u_resolution"),l=I.getUniformLocation(o,"u_image"),c=I.createVertexArray();I.bindVertexArray(c);var h=I.createBuffer();I.enableVertexAttribArray(a),I.bindBuffer(I.ARRAY_BUFFER,h);var u=2,f=I.FLOAT,m=!1,d=0,g=0;I.vertexAttribPointer(a,u,f,m,d,g);var w=I.createBuffer();I.bindBuffer(I.ARRAY_BUFFER,w),I.bufferData(I.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),I.STATIC_DRAW),I.enableVertexAttribArray(i),u=2,f=I.FLOAT,m=!1,d=0,g=0,I.vertexAttribPointer(i,u,f,m,d,g);var p=I.createTexture();I.activeTexture(I.TEXTURE0+0),I.bindTexture(I.TEXTURE_2D,p),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.NEAREST),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.NEAREST);var v=I.RGBA,b=I.RGBA,T=I.UNSIGNED_BYTE;I.texImage2D(I.TEXTURE_2D,0,v,b,T,r),I.viewport(0,0,I.canvas.width,I.canvas.height),I.useProgram(o),I.bindVertexArray(c),I.uniform2f(s,I.canvas.width,I.canvas.height),I.uniform2f(C,t,n),I.uniform1i(l,0),I.bindBuffer(I.ARRAY_BUFFER,h),x(I,0,0,r.width,r.height),x(I,0,0,r.width,r.height),U(t,n)}function x(e,t,n,r,o){var a=t,i=t+r,s=n,l=n+o;e.bufferData(e.ARRAY_BUFFER,new Float32Array([a,s,i,s,a,l,a,l,i,s,i,l]),e.STATIC_DRAW)}}(n,e,t);const c=document.getElementById("color-input");[...document.querySelectorAll('input[type="checkbox"]')].map((e=>{const t=e.className;window[t]=!0,e.oninput=e=>{window[t]=e.target.checked}})),c.oninput=e=>{const t=function(e){let t=e.replace("#","");if(t.length%3)return"hex格式不正确！";let n=t.length/3,r=6/t.length;return[parseInt("0x"+t.substring(0*n,1*n))**r,parseInt("0x"+t.substring(1*n,2*n))**r,parseInt("0x"+t.substring(2*n))**r]}(e.target.value),[n,r]=D(...t);window._wasm&&f(n,r),window._jss&&v(n,r),window._jsm&&y(n,r),window._webgl&&U(n,r)}}()})();