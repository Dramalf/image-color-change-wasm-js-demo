(()=>{"use strict";var e,t={},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={id:e,loaded:!1,exports:{}};return t[e](a,a.exports,r),a.loaded=!0,a.exports}function o(e,t,n){var r,o,a;if(0==t)r=o=a=n;else{function l(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var i=n<.5?n*(1+t):n+t-n*t,s=2*n-i;r=l(s,i,e+1/3),o=l(s,i,e),a=l(s,i,e-1/3)}return[255*r,255*o,255*a]}function a(e,t,n){e/=255,t/=255,n/=255;var r,o,a=Math.max(e,t,n),i=Math.min(e,t,n),s=(a+i)/2;if(a==i)r=o=0;else{var l=a-i;switch(o=s>.5?l/(2-a-i):l/(a+i),a){case e:r=(t-n)/l+(t<n?6:0);break;case t:r=(n-e)/l+2;break;case n:r=(e-t)/l+4}r/=6}return[r,o,s]}r.m=t,r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,n)=>(r.f[n](e,t),t)),[])),r.u=e=>e+".index.js",r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},r.l=(t,n,o,a)=>{if(e[t])e[t].push(n);else{var i,s;if(void 0!==o)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var d=l[c];if(d.getAttribute("src")==t){i=d;break}}i||(s=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,r.nc&&i.setAttribute("nonce",r.nc),i.src=t),e[t]=[n];var u=(n,r)=>{i.onerror=i.onload=null,clearTimeout(m);var o=e[t];if(delete e[t],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(r))),n)return n(r)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=u.bind(null,i.onerror),i.onload=u.bind(null,i.onload),s&&document.head.appendChild(i)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{r.b=document.baseURI||self.location.href;var e={792:0};r.f.j=(t,n)=>{var o=r.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var a=new Promise(((n,r)=>o=e[t]=[n,r]));n.push(o[2]=a);var i=r.p+r.u(t),s=new Error;r.l(i,(n=>{if(r.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var a=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+i+")",s.name="ChunkLoadError",s.type=a,s.request=i,o[1](s)}}),"chunk-"+t,t)}};var t=(t,n)=>{var o,a,[i,s,l]=n,c=0;if(i.some((t=>0!==e[t]))){for(o in s)r.o(s,o)&&(r.m[o]=s[o]);l&&l(r)}for(t&&t(n);c<i.length;c++)a=i[c],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),async function(){const e=navigator.hardwareConcurrency,t=[];for(let n=0;n<e;n++){const e=new Worker("./jsWorker.js");t.push(e)}let n,i,s,l;if(await(async e=>{try{return"undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(e)}catch(e){return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))){l=await r.e(9).then(r.bind(r,390));let{memory:e}=await l.default();await l.initThreadPool(navigator.hardwareConcurrency),n=l.new_buffer,i=l.harmonize_rayon,s=e}else{l=await r.e(505).then(r.bind(r,886));let{memory:e}=await l.default();n=l.new_buffer,i=l.harmonize_rayon,s=e}document.getElementById("wasm-title").innerText="wasm multi-thread";const c=new Image,d=new Image,u=new Image,m=document.getElementById("wasm-t"),h=document.getElementById("js-t"),g=document.getElementById("js-m-t");let f=null,p=null;function w(e,t,r,o){const l=document.getElementById("c1"),c=e.width,d=e.height;l.width=c,l.height=d;const u=l.getContext("2d");u.drawImage(e,0,0,c,d);let h=performance.now();if(!f){f=n("test",c*d*4);const e=u.getImageData(0,0,c,d);p=new Uint8ClampedArray(s.buffer,f,c*d*4),p.set(e.data)}let[g,w]=a(t,r,o);i("test",g,w),u.putImageData(new ImageData(p.slice(),c,d),0,0);let y=performance.now();console.log("wasm",Math.floor(y-h)+"ms"),m.innerHTML=Math.floor(y-h)+"ms"}function y(e,t,n,r){const i=document.getElementById("c2"),s=e.width,l=e.height;i.width=s,i.height=l;const c=i.getContext("2d");c.drawImage(e,0,0,s,l);const d=c.getImageData(0,0,s,l);let u=performance.now();const m=d.data;let[g,f]=a(t,n,r);for(let e=0;e<m.length;e+=4){const[t,n,r]=[m[e],m[e+1],m[e+2]],i=a(t,n,r);i[0]=g,f>.1&&(i[1]=f);const s=o(i[0],i[1],i[2]);m[e]=s[0],m[e+1]=s[1],m[e+2]=s[2]}c.putImageData(d,0,0);let p=performance.now();console.log("JS",Math.floor(p-u)+"ms"),h.innerHTML=Math.floor(p-u)+"ms"}c.onload=()=>{w(c,202,208,195)},d.onload=()=>{y(d,202,208,195)},u.onload=()=>{v(c,202,208,195)};const b=document.getElementById("origin").src;function v(n,r,o,a){const i=document.getElementById("c3"),s=n.width,l=n.height;i.width=s,i.height=l;const c=i.getContext("2d");c.drawImage(n,0,0,s,l);const d=c.getImageData(0,0,s,l).data;let u=performance.now();const m=Math.ceil(i.height/e);for(let e=0;e<t.length;e++){const n=e*m*i.width*4,s=Math.min(m*i.width*4,d.length-n),l=d.slice(n,n+s);t[e].postMessage({imageData:l,width:i.width,height:m,r,g:o,b:a,offset:n},[l.buffer])}let h=0;for(let e=0;e<t.length;e++)t[e].onmessage=function(e){const{imageData:n,offset:r}=e.data;if(d.set(new Uint8ClampedArray(n),r),h++,console.log(n,"imageData"),h===t.length){c.putImageData(new ImageData(d,s,l),0,0);let e=performance.now();console.log("JS multi worker",Math.floor(e-u)+"ms"),g.innerHTML=Math.floor(e-u)+"ms"}}}console.log(b),c.src=b,d.src=b,u.src=b,document.getElementById("color-input").oninput=e=>{const t=function(e){let t=e.replace("#","");if(t.length%3)return"hex格式不正确！";let n=t.length/3,r=6/t.length;return[parseInt("0x"+t.substring(0*n,1*n))**r,parseInt("0x"+t.substring(1*n,2*n))**r,parseInt("0x"+t.substring(2*n))**r]}(e.target.value);w(c,...t),y(d,...t),v(u,...t)}}()})();